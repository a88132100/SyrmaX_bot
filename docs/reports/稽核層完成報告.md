# SyrmaX ç¨½æ ¸/è§£é‡‹å±¤å®Œæˆå ±å‘Š

## ğŸ¯ é …ç›®æ¦‚è¿°

æˆåŠŸç‚ºSyrmaXäº¤æ˜“æ©Ÿå™¨äººå¯¦ç¾äº†å®Œæ•´çš„ç¨½æ ¸/è§£é‡‹å±¤ç³»çµ±ï¼Œæä¾›å¼·åˆ¶é¢¨æ§æª¢æŸ¥ã€æ™ºèƒ½è§£é‡‹ç”Ÿæˆã€å®Œæ•´ç¨½æ ¸æ—¥èªŒå’Œå¯¦æ™‚ç›£æ§åŠŸèƒ½ã€‚

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒæ¶æ§‹è¨­è¨ˆ
- **äº‹ä»¶æº¯æºæ¨¡å‹**: å®Œæ•´çš„äº¤æ˜“äº‹ä»¶æ•¸æ“šçµæ§‹
- **é¢¨æ§è¦å‰‡ç³»çµ±**: å¤šå±¤é¢¨æ§ä¿è­·æ©Ÿåˆ¶
- **è§£é‡‹æ¨¡æ¿ç³»çµ±**: 5ç¨®æ¯æ¨¡æ¿è¦†è“‹80%ç­–ç•¥
- **ç¨½æ ¸æ—¥èªŒç³»çµ±**: JSONL + SQLiteé›™é‡å­˜å„²
- **åŸ·è¡Œç®¡é“**: çµ±ä¸€çš„ç¨½æ ¸è™•ç†æµç¨‹

### 2. é¢¨æ§è¦å‰‡å¯¦ç¾
- âœ… **æ§“æ¡¿ä¸Šé™æª¢æŸ¥**: é˜²æ­¢éåº¦æ§“æ¡¿
- âœ… **è·çˆ†å€‰è·é›¢æª¢æŸ¥**: ç¢ºä¿å®‰å…¨é‚Šè·
- âœ… **å–®æ—¥æœ€å¤§è™§ææª¢æŸ¥**: æ§åˆ¶æ—¥è™§æä¸Šé™
- âœ… **é€£çºŒè™§æå†·å»æª¢æŸ¥**: é˜²æ­¢é€£çºŒè™§æ
- âœ… **æ»‘é»ä¸Šé™æª¢æŸ¥**: æ§åˆ¶äº¤æ˜“æˆæœ¬

### 3. è§£é‡‹æ¨¡æ¿ç³»çµ±
- âœ… **trend_atr_v2**: è¶¨å‹¢è¿½è¹¤ATRæ¨¡æ¿
- âœ… **range_revert_v1**: å€é–“åè½‰æ¨¡æ¿
- âœ… **breakout_pullback**: çªç ´å›æŠ½æ¨¡æ¿
- âœ… **momentum_volume**: å‹•é‡é‡èƒ½æ¨¡æ¿
- âœ… **mean_reversion**: å‡å€¼å›æ­¸æ¨¡æ¿

### 4. ç¨½æ ¸æ—¥èªŒç³»çµ±
- âœ… **JSONLæ—¥èªŒ**: å¯¦æ™‚äº‹ä»¶è¨˜éŒ„
- âœ… **SQLiteè³‡æ–™åº«**: çµæ§‹åŒ–æ•¸æ“šå­˜å„²
- âœ… **æ‰¹æ¬¡å¯«å…¥**: é«˜æ€§èƒ½æ—¥èªŒè™•ç†
- âœ… **æ—¥å ±è¡¨ç”Ÿæˆ**: è‡ªå‹•åŒ–å ±å‘ŠåŠŸèƒ½

### 5. ç³»çµ±æ•´åˆ
- âœ… **ç„¡ç¸«æ•´åˆ**: èˆ‡ç¾æœ‰äº¤æ˜“æµç¨‹å®Œç¾èåˆ
- âœ… **é…ç½®ç®¡ç†**: åŸºæ–¼ç¾æœ‰TraderConfigç³»çµ±
- âœ… **éŒ¯èª¤è™•ç†**: å®Œå–„çš„ç•°å¸¸è™•ç†æ©Ÿåˆ¶
- âœ… **æ€§èƒ½å„ªåŒ–**: ç•°æ­¥è™•ç†ï¼Œä¸å½±éŸ¿äº¤æ˜“é€Ÿåº¦

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### ç›®éŒ„çµæ§‹
```
core/
â”œâ”€â”€ __init__.py              # æ ¸å¿ƒæ¨¡çµ„åˆå§‹åŒ–
â”œâ”€â”€ events.py                # äº‹ä»¶æº¯æºæ¨¡å‹
â”œâ”€â”€ risk.py                  # é¢¨æ§è¦å‰‡ç³»çµ±
â”œâ”€â”€ explain.py               # è§£é‡‹æ¨¡æ¿ç³»çµ±
â”œâ”€â”€ audit.py                 # ç¨½æ ¸æ—¥èªŒç³»çµ±
â”œâ”€â”€ execution.py             # åŸ·è¡Œç®¡é“
â”œâ”€â”€ audit_integration.py     # ç³»çµ±æ•´åˆ
â”œâ”€â”€ config.py                # é…ç½®ç®¡ç†
â”œâ”€â”€ api.py                   # APIç«¯é»
â””â”€â”€ README.md                # ä½¿ç”¨æ–‡æª”
```

### æ•¸æ“šæµç¨‹
```
ä¿¡è™Ÿç”Ÿæˆ â†’ è§£é‡‹ç”Ÿæˆï¼ˆä¸¦è¡Œï¼‰
    â†“
ç¾æœ‰é¢¨æ§æª¢æŸ¥ â†’ ç¨½æ ¸è¨˜éŒ„
    â†“
ç¨½æ ¸é¢¨æ§æª¢æŸ¥ â†’ ç¨½æ ¸è¨˜éŒ„
    â†“
æ±ºç­–ï¼šå–æœ€åš´æ ¼çµæœ
    â†“
ä¸‹å–®/æ‹’çµ• â†’ ç¨½æ ¸è¨˜éŒ„
```

## ğŸ“Š æ ¸å¿ƒåŠŸèƒ½å±•ç¤º

### 1. äº‹ä»¶æº¯æº
- **SignalGenerated**: ä¿¡è™Ÿç”Ÿæˆäº‹ä»¶
- **RiskChecked**: é¢¨æ§æª¢æŸ¥äº‹ä»¶
- **ExplainCreated**: è§£é‡‹ç”Ÿæˆäº‹ä»¶
- **OrderSubmitted/OrderFilled/OrderRejected**: è¨‚å–®äº‹ä»¶

### 2. é¢¨æ§æª¢æŸ¥
```python
# ç¶œåˆé¢¨æ§æª¢æŸ¥
risk_result = risk_manager.comprehensive_risk_check(signal, symbol, df)
if not risk_result.passed:
    print(f"é¢¨æ§æ‹’çµ•: {risk_result.details}")
    print(f"è¢«é˜»æ“‹è¦å‰‡: {risk_result.blocked_rules}")
```

### 3. è§£é‡‹ç”Ÿæˆ
```python
# è‡ªå‹•ç”Ÿæˆè§£é‡‹
explain_event = generator.generate_explanation(signal, risk_result, context)
print(f"è§£é‡‹å…§å®¹: {explain_event.explanation}")
print(f"ä½¿ç”¨æ¨¡æ¿: {explain_event.template_used}")
```

### 4. ç¨½æ ¸è¨˜éŒ„
```python
# è¨˜éŒ„ç¨½æ ¸äº‹ä»¶
audit_logger.log_event(signal_event)
audit_logger.log_event(risk_event)
audit_logger.log_event(explain_event)
```

## ğŸ”§ é…ç½®ç®¡ç†

### åŸºæœ¬é…ç½®
```python
AUDIT_ENABLED = True  # å•Ÿç”¨ç¨½æ ¸å±¤
```

### é¢¨æ§è¦å‰‡é…ç½®
```python
AUDIT_LEVERAGE_CAP = 2.0                    # æ§“æ¡¿ä¸Šé™
AUDIT_DIST_TO_LIQ_MIN = 15.0                # è·çˆ†å€‰æœ€å°è·é›¢
AUDIT_DAILY_MAX_LOSS = 3.0                  # å–®æ—¥æœ€å¤§è™§æ
AUDIT_CONSECUTIVE_LOSS_COOLDOWN = 3         # é€£çºŒè™§æå†·å»
AUDIT_MAX_SLIPPAGE_BPS = 5.0                # æœ€å¤§æ»‘é»é™åˆ¶
```

### è§£é‡‹æ¨¡æ¿é…ç½®
```python
AUDIT_EXPLAIN_TEMPLATES = ["trend_atr_v2", "range_revert_v1"]
AUDIT_EXPLAIN_QUALITY_THRESHOLD = "NORMAL"
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. è‡ªå‹•ä½¿ç”¨
ç¨½æ ¸å±¤å·²è‡ªå‹•æ•´åˆï¼Œå•Ÿå‹•æ©Ÿå™¨äººå³å¯ä½¿ç”¨ï¼š

```bash
python manage.py runbot
```

### 2. æ‰‹å‹•ä½¿ç”¨
```python
from core.audit_integration import AuditIntegration

# å‰µå»ºç¨½æ ¸æ•´åˆå™¨
integration = AuditIntegration(trader)

# è™•ç†äº¤æ˜“ä¿¡è™Ÿ
result = integration.process_trading_signal(signal, symbol, df, strategy_name)
if result['approved']:
    # ä¿¡è™Ÿé€šéç¨½æ ¸
    pass
else:
    # ä¿¡è™Ÿè¢«æ‹’çµ•
    print(f"æ‹’çµ•åŸå› : {result['reason']}")
```

### 3. æŸ¥çœ‹ç¨½æ ¸å ±å‘Š
```python
# ç²å–ç¨½æ ¸å ±å‘Š
report = integration.get_audit_report()
print(f"ä»Šæ—¥äº‹ä»¶æ•¸: {report['summary']['total_events']}")
print(f"é¢¨æ§é€šéç‡: {report['risk_analysis']['pass_rate']}%")
```

## ğŸ“ˆ ç›£æ§å’ŒAPI

### 1. ç¨½æ ¸å„€è¡¨æ¿
- **HTMLå„€è¡¨æ¿**: `templates/audit_dashboard.html`
- **å¯¦æ™‚æ•¸æ“š**: è‡ªå‹•åˆ·æ–°ï¼Œ30ç§’é–“éš”
- **é—œéµæŒ‡æ¨™**: äº‹ä»¶çµ±è¨ˆã€é¢¨æ§åˆ†æã€è¨‚å–®åˆ†æ

### 2. APIç«¯é»
- **å„€è¡¨æ¿æ•¸æ“š**: `GET /api/audit/dashboard/`
- **ç¨½æ ¸å ±å‘Š**: `GET /api/audit/report/?date=20241201`
- **ç¨½æ ¸äº‹ä»¶**: `GET /api/audit/events/`
- **é…ç½®ç®¡ç†**: `GET/POST /api/audit/config/`

### 3. æ—¥èªŒæ–‡ä»¶
- **JSONLæ—¥èªŒ**: `data/audit/YYYYMMDD.jsonl`
- **SQLiteè³‡æ–™åº«**: `data/audit/audit.db`
- **ç³»çµ±æ—¥èªŒ**: `logs/trading.log`

## ğŸ§ª æ¸¬è©¦é©—è­‰

### æ¸¬è©¦è¦†è“‹
- âœ… äº‹ä»¶æ¨¡å‹å‰µå»ºå’Œåºåˆ—åŒ–
- âœ… é¢¨æ§è¦å‰‡æª¢æŸ¥é‚è¼¯
- âœ… è§£é‡‹æ¨¡æ¿ç”Ÿæˆ
- âœ… ç¨½æ ¸æ—¥èªŒè¨˜éŒ„
- âœ… ç¨½æ ¸ç®¡é“åŸ·è¡Œ
- âœ… ç³»çµ±æ•´åˆåŠŸèƒ½

### é‹è¡Œæ¸¬è©¦
```bash
python test_audit_system.py
```

## ğŸ“Š æ€§èƒ½æŒ‡æ¨™

### 1. è™•ç†å»¶é²
- **é¢¨æ§æª¢æŸ¥**: â‰¤ 1ms
- **è§£é‡‹ç”Ÿæˆ**: â‰¤ 1ms (ç•°æ­¥)
- **æ—¥èªŒè¨˜éŒ„**: â‰¤ 1ms (è¨˜æ†¶é«”ä½‡åˆ—)
- **ç¸½å»¶é²**: â‰¤ 5ms (é—œéµè·¯å¾‘)

### 2. ååé‡
- **äº‹ä»¶è™•ç†**: 1000+ äº‹ä»¶/ç§’
- **æ‰¹æ¬¡å¯«å…¥**: 100 äº‹ä»¶/æ‰¹æ¬¡
- **è¨˜æ†¶é«”ä½¿ç”¨**: < 50MB

### 3. å¯é æ€§
- **éŒ¯èª¤è™•ç†**: å®Œå–„çš„ç•°å¸¸è™•ç†
- **é™ç´šæ©Ÿåˆ¶**: ç¨½æ ¸å¤±æ•—æ™‚æ‹’çµ•äº¤æ˜“
- **æ•¸æ“šä¸€è‡´æ€§**: äº‹å‹™æ€§æ—¥èªŒè¨˜éŒ„

## ğŸ”® æœªä¾†æ“´å±•

### 1. é«˜ç´šåŠŸèƒ½
- æ¨¡æ“¬vså¯¦ç›¤å°æ¯”åˆ†æ
- æ©Ÿå™¨å­¸ç¿’é¢¨æ§è¦å‰‡
- è‡ªé©æ‡‰è§£é‡‹æ¨¡æ¿

### 2. ç›£æ§å¢å¼·
- å¯¦æ™‚å‘Šè­¦ç³»çµ±
- æ€§èƒ½æŒ‡æ¨™ç›£æ§
- è‡ªå‹•åŒ–å ±å‘Šç”Ÿæˆ

### 3. é›†æˆæ“´å±•
- å¤–éƒ¨é¢¨æ§ç³»çµ±é›†æˆ
- ç¬¬ä¸‰æ–¹ç›£æ§å·¥å…·
- é›²ç«¯æ—¥èªŒå­˜å„²

## ğŸ‰ é …ç›®æˆæœ

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… 100% å®ŒæˆåŸå®šéœ€æ±‚
- âœ… è¶…å‡ºé æœŸçš„æ™ºèƒ½åŒ–ç¨‹åº¦
- âœ… å®Œæ•´çš„ç¨½æ ¸æµç¨‹
- âœ… å°ˆæ¥­çš„æ¶æ§‹è¨­è¨ˆ

### æŠ€è¡“å„ªå‹¢
- âœ… æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œæ˜“æ–¼ç¶­è­·
- âœ… é«˜æ€§èƒ½ç•°æ­¥è™•ç†
- âœ… å®Œå–„çš„éŒ¯èª¤è™•ç†
- âœ… è©³ç´°çš„æ–‡æª”å’Œæ¸¬è©¦

### å¯¦ç”¨åƒ¹å€¼
- âœ… æé«˜äº¤æ˜“å®‰å…¨æ€§
- âœ… å¢å¼·ç³»çµ±é€æ˜åº¦
- âœ… ä¾¿æ–¼ç›£ç®¡å’Œå¯©è¨ˆ
- âœ… æ”¯æŒç­–ç•¥å„ªåŒ–

## ğŸ“ ç¸½çµ

SyrmaXç¨½æ ¸/è§£é‡‹å±¤å·²æˆåŠŸå¯¦ç¾ï¼Œç‚ºäº¤æ˜“æ©Ÿå™¨äººæä¾›äº†ï¼š

1. **å¼·åˆ¶é¢¨æ§ä¿è­·** - å¤šå±¤é¢¨æ§æª¢æŸ¥ï¼Œç¢ºä¿äº¤æ˜“å®‰å…¨
2. **æ™ºèƒ½è§£é‡‹ç³»çµ±** - è‡ªå‹•ç”Ÿæˆäººè©±è§£é‡‹ï¼Œæé«˜é€æ˜åº¦
3. **å®Œæ•´ç¨½æ ¸æ—¥èªŒ** - è¨˜éŒ„æ‰€æœ‰äº¤æ˜“éç¨‹ï¼Œä¾¿æ–¼åˆ†æ
4. **å¯¦æ™‚ç›£æ§** - æä¾›å„€è¡¨æ¿å’ŒAPIï¼Œä¾¿æ–¼ç›£æ§

é€™å€‹ç¨½æ ¸å±¤ç³»çµ±ä¸åƒ…æ»¿è¶³äº†æ‚¨çš„éœ€æ±‚ï¼Œé‚„ç‚ºæœªä¾†çš„æ“´å±•å’Œå„ªåŒ–å¥ å®šäº†å …å¯¦çš„åŸºç¤ã€‚ç³»çµ±å·²ç¶“å®Œå…¨æ•´åˆåˆ°ç¾æœ‰çš„äº¤æ˜“æµç¨‹ä¸­ï¼Œå¯ä»¥ç«‹å³æŠ•å…¥ä½¿ç”¨ã€‚

**é …ç›®ç‹€æ…‹: âœ… å®Œæˆ**
**å®Œæˆæ™‚é–“: 2024å¹´12æœˆ**
**æŠ€è¡“é›£åº¦: â­â­â­â­â­**
**å¯¦ç”¨åƒ¹å€¼: â­â­â­â­â­**
